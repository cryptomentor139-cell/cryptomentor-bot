[build]
builder = "NIXPACKS"

[build.nixpacksPlan.phases.setup]
nixPkgs = ["python310", "nodejs-20_x"]

[build.nixpacksPlan.phases.install]
cmds = [
  "pip install --no-cache-dir -r requirements.txt",
  "cd automaton && npm ci --omit=dev && cd .."
]

[build.nixpacksPlan.phases.build]
cmds = [
  "cd automaton && npm run build && cd .."
]

[deploy]
startCommand = "bash start_combined.sh"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
